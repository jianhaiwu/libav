From 12640e4cbb142be0cd025bcf37f1ea437bdfecd0 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Diego=20Elio=20Petten=C3=B2?= <flameeyes@flameeyes.eu>
Date: Mon, 18 Aug 2014 09:27:49 +0100
Subject: [PATCH 01/37] tiff: Return proper error for missing LZMA compression
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

The LZMA support is a semi-official extension supported by libtiff 4.0.0
and later.

Signed-off-by: Diego Elio Petten√≤ <flameeyes@flameeyes.eu>
Signed-off-by: Luca Barbato <lu_zero@gentoo.org>
---
 libavcodec/tiff.c | 3 +++
 libavcodec/tiff.h | 3 ++-
 2 files changed, 5 insertions(+), 1 deletion(-)

diff --git a/libavcodec/tiff.c b/libavcodec/tiff.c
index ca5ec75..3b2fc7d 100644
--- a/libavcodec/tiff.c
+++ b/libavcodec/tiff.c
@@ -408,6 +408,9 @@ static int tiff_decode_tag(TiffContext *s)
         case TIFF_NEWJPEG:
             avpriv_report_missing_feature(s->avctx, "JPEG compression");
             return AVERROR_PATCHWELCOME;
+        case TIFF_LZMA:
+            avpriv_report_missing_feature(s->avctx, "LZMA compression");
+            return AVERROR_PATCHWELCOME;
         default:
             av_log(s->avctx, AV_LOG_ERROR, "Unknown compression method %i\n",
                    s->compr);
diff --git a/libavcodec/tiff.h b/libavcodec/tiff.h
index 8a3f7f7..68ac695 100644
--- a/libavcodec/tiff.h
+++ b/libavcodec/tiff.h
@@ -71,7 +71,8 @@ enum TiffCompr {
     TIFF_NEWJPEG,
     TIFF_ADOBE_DEFLATE,
     TIFF_PACKBITS = 0x8005,
-    TIFF_DEFLATE  = 0x80B2
+    TIFF_DEFLATE  = 0x80B2,
+    TIFF_LZMA     = 0x886D,
 };
 
 enum TiffTypes {
-- 
1.9.1

