From a3138ebfa85ec0d3aa7cbf8f2a09e40a220521cf Mon Sep 17 00:00:00 2001
From: Diego Biurrun <diego@biurrun.de>
Date: Sat, 20 Oct 2012 01:12:18 +0200
Subject: [PATCH 266/278] fate: Add dependencies for aac, alac, amrnb, amrwb,
 atrac tests

---
 tests/fate/aac.mak   |   11 ++++++++---
 tests/fate/alac.mak  |    2 +-
 tests/fate/amrnb.mak |    2 +-
 tests/fate/amrwb.mak |    2 +-
 tests/fate/atrac.mak |    8 +++++---
 5 files changed, 16 insertions(+), 9 deletions(-)

diff --git a/tests/fate/aac.mak b/tests/fate/aac.mak
index ea738c5..e840bf0 100644
--- a/tests/fate/aac.mak
+++ b/tests/fate/aac.mak
@@ -53,9 +53,10 @@ fate-aac-ap05_48: REF = $(SAMPLES)/aac/ap05_48.s16
 fate-aac-ct%: CMD = pcm -i $(SAMPLES)/aac/CT_DecoderCheck/$(@:fate-aac-ct-%=%)
 fate-aac-ct%: REF = $(SAMPLES)/aac/CT_DecoderCheck/aacPlusv2.wav
 
+FATE_AAC_CT_RAW = fate-aac-ct-sbr_i-ps_i.aac
+
 FATE_AAC_CT = sbr_bc-ps_i.3gp  \
               sbr_bic-ps_i.3gp \
-              sbr_i-ps_i.aac   \
               sbr_bc-ps_bc.mp4 \
               sbr_bc-ps_i.mp4  \
               sbr_i-ps_bic.mp4 \
@@ -71,7 +72,11 @@ FATE_AAC_LATM += fate-aac-latm_stereo_to_51
 fate-aac-latm_stereo_to_51: CMD = pcm -i $(SAMPLES)/aac/latm_stereo_to_51.ts -channel_layout 5.1
 fate-aac-latm_stereo_to_51: REF = $(SAMPLES)/aac/latm_stereo_to_51_ref.s16
 
-FATE_AAC_ALL = $(FATE_AAC) $(FATE_AAC_LATM)
+FATE_AAC-$(call      DEMDEC, AAC,    AAC)      += $(FATE_AAC_CT_RAW)
+FATE_AAC-$(call      DEMDEC, MOV,    AAC)      += $(FATE_AAC)
+FATE_AAC_LATM-$(call DEMDEC, MPEGTS, AAC_LATM) += $(FATE_AAC_LATM)
+
+FATE_AAC_ALL = $(FATE_AAC-yes) $(FATE_AAC_LATM-yes)
 
 $(FATE_AAC_ALL): CMP  = oneoff
 $(FATE_AAC_ALL): FUZZ = 2
@@ -79,4 +84,4 @@ $(FATE_AAC_ALL): FUZZ = 2
 FATE_SAMPLES_AVCONV += $(FATE_AAC_ALL)
 
 fate-aac: $(FATE_AAC_ALL)
-fate-aac-latm: $(FATE_AAC_LATM)
+fate-aac-latm: $(FATE_AAC_LATM-yes)
diff --git a/tests/fate/alac.mak b/tests/fate/alac.mak
index b55b594..814a5b7 100644
--- a/tests/fate/alac.mak
+++ b/tests/fate/alac.mak
@@ -11,5 +11,5 @@ fate-alac-%: CMD = enc_dec_pcm mov wav s16le $(REF) -c alac $(OPTS)
 fate-alac-%: CMP = oneoff
 fate-alac-%: FUZZ = 0
 
-FATE_SAMPLES_AVCONV += $(FATE_ALAC)
+FATE_SAMPLES_AVCONV-$(call ENCDEC, ALAC, MOV) += $(FATE_ALAC)
 fate-alac: $(FATE_ALAC)
diff --git a/tests/fate/amrnb.mak b/tests/fate/amrnb.mak
index 6e3f2a4..6dbba58 100644
--- a/tests/fate/amrnb.mak
+++ b/tests/fate/amrnb.mak
@@ -32,5 +32,5 @@ fate-amrnb-12k2: REF = $(SAMPLES)/amrnb/12.2k.pcm
 
 $(FATE_AMRNB): CMP = stddev
 
-FATE_SAMPLES_AVCONV += $(FATE_AMRNB)
+FATE_SAMPLES_AVCONV-$(call DEMDEC, AMR, AMRNB) += $(FATE_AMRNB)
 fate-amrnb: $(FATE_AMRNB)
diff --git a/tests/fate/amrwb.mak b/tests/fate/amrwb.mak
index 0b7be72..99c2737 100644
--- a/tests/fate/amrwb.mak
+++ b/tests/fate/amrwb.mak
@@ -43,5 +43,5 @@ fate-amrwb-23k85-2: REF = $(SAMPLES)/amrwb/deus-23k85.pcm
 
 $(FATE_AMRWB): CMP = stddev
 
-FATE_SAMPLES_AVCONV += $(FATE_AMRWB)
+FATE_SAMPLES_AVCONV-$(call DEMDEC, AMR, AMRWB) += $(FATE_AMRWB)
 fate-amrwb: $(FATE_AMRWB)
diff --git a/tests/fate/atrac.mak b/tests/fate/atrac.mak
index 39b788a..3ac5553 100644
--- a/tests/fate/atrac.mak
+++ b/tests/fate/atrac.mak
@@ -1,4 +1,4 @@
-FATE_ATRAC1 += fate-atrac1
+FATE_ATRAC1-$(call DEMDEC, AEA, ATRAC1) += fate-atrac1
 fate-atrac1: CMD = pcm -i $(SAMPLES)/atrac1/test_tones_small.aea
 fate-atrac1: REF = $(SAMPLES)/atrac1/test_tones_small.pcm
 
@@ -14,11 +14,13 @@ FATE_ATRAC3 += fate-atrac3-3
 fate-atrac3-3: CMD = pcm -i $(SAMPLES)/atrac3/mc_sich_at3_132_small.wav
 fate-atrac3-3: REF = $(SAMPLES)/atrac3/mc_sich_at3_132_small.pcm
 
-FATE_ATRAC_ALL = $(FATE_ATRAC1) $(FATE_ATRAC3)
+FATE_ATRAC3-$(call DEMDEC, WAV, ATRAC3) += $(FATE_ATRAC3)
+
+FATE_ATRAC_ALL = $(FATE_ATRAC1-yes) $(FATE_ATRAC3-yes)
 
 $(FATE_ATRAC_ALL): CMP = oneoff
 
 FATE_SAMPLES_AVCONV += $(FATE_ATRAC_ALL)
 
 fate-atrac:  $(FATE_ATRAC_ALL)
-fate-atrac3: $(FATE_ATRAC3)
+fate-atrac3: $(FATE_ATRAC3-yes)
-- 
1.7.9.5

