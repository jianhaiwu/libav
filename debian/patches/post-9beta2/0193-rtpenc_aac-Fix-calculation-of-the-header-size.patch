From e004d175fe2463af8242e390b15350f4745be7b4 Mon Sep 17 00:00:00 2001
From: Luca Abeni <lucabe72@email.it>
Date: Thu, 8 Nov 2012 01:38:50 +0100
Subject: [PATCH 193/278] rtpenc_aac: Fix calculation of the header size
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Previously the high end byte was always set to zero. Also get
rid of an unnecessary multiplication (which in practice couldn't
overflow) before shifting.

Signed-off-by: Martin Storsj√∂ <martin@martin.st>
---
 libavformat/rtpenc_aac.c |    4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/libavformat/rtpenc_aac.c b/libavformat/rtpenc_aac.c
index 86318df..1b2fa0a 100644
--- a/libavformat/rtpenc_aac.c
+++ b/libavformat/rtpenc_aac.c
@@ -47,8 +47,8 @@ void ff_rtp_send_aac(AVFormatContext *s1, const uint8_t *buff, int size)
             memmove(p + 2, s->buf + 2, au_size);
         }
         /* Write the AU header size */
-        p[0] = ((au_size * 8) & 0xFF) >> 8;
-        p[1] = (au_size * 8) & 0xFF;
+        p[0] =  au_size >> 5;
+        p[1] = (au_size & 0x1F) << 3;
 
         ff_rtp_send_data(s1, p, s->buf_ptr - p, 1);
 
-- 
1.7.9.5

